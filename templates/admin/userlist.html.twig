{% extends "admin/master.html.twig" %}

{% block title %}User List{% endblock %}

{% block addHead %}
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script>
        var currId = 0;
        $(document).ajaxError(function() {
            alert("AJAX error");
        });
        $(document).ready(function() {
            //refreshUserList();
            $("#showEidtUser").click(function(){
                $("#viewEditPane").show();
            });
            $("#cancel").click(function(){
                $("#viewEditPane").hide();
            });
            $("#update").click(function(){
                var phoneVal = $("input[name=phone]").val();
                var addrVal = $("input[name=address]").val();
                var roleVal = $("select[name=role]").val();
                var userObj = {phoneNumber: phoneVal, address: addrVal, role: roleVal};
                var josnString = JSON.stringify(userObj);

                $.ajax({
                    url: '/admin/userlist/' + currId,
                    type: 'PATCH',
                    data: josnString,
                    dataType: 'json'
                }).done(function (newId) {
                    alert("Record with Id=" + currId + "updated");
                    currId = 0;
                    $("#viewEditPane").hide();
                    refreshUserList();

                });
            });

            $("#delete").click(function(){
                if(currId == 0) return;
                if(!confirm("Are you sure you want to delete this user?")) return;
                $.ajax({
                    url: '/admin/userlist/' + currId,
                    type: 'DELETE',
                    dataType: 'json'
                }).done(function (result) {
                    alert("deleted successfully" + result);
                    refreshUserList();
                    currId = 0;
                    $("#viewEditPane").hide();
                });
            });
        });

        function selectUser(id){
            $.ajax({
                url: '/admin/userlist/' + id,
                type: 'GET',
                dataType: 'json'
            }).done(function (user) {
                currId = user.id;
                $("#id").html(user.id);
                $("#email").html(user.email);
                $("#name").html(user.firstName + " " + user.lastName);
                $("#gender").html(user.gender);
                $("#createdTS").html(user.createdTS);
                $("input[name=phone]").val(user.phoneNumber);
                $("input[name=address]").val(user.address);
                $("select[name=role]").val(user.role);
                $("#viewEditPane").show();
            });
        }

    </script>
 {% endblock %}

{% block content %}
<div id="mainAppPane">
    <div id="listPane">
        <table id="listTable">
            <tr><th>#</th><th>Email</th><th>Role</th><th>Account Created Time</th><th>Name</th><th>Gender</th><th>Phone Number</th><th>Address</th></tr>
            {% for a in list %}
                <tr onclick="selectUser(' + {{a.id}} + ')">
                    <td>{{a.id}}</td>
                    <td>{{a.email}}</td>
                    <td>{{a.role}}</td>
                    <td>{{a.createdTS}}</td>
                    <td>{{a.firstName}} {{a.lastName}}</td>
                    <td>{{a.gender}}</td>
                    <td>{{a.phoneNumber}}</td>
                    <td>{{a.address}}</td>
                </tr>
            {% endfor %}
        </table>
    </div>
            <div id="viewEditPane" style="display: none;">
                Id: <span id="id">{{a.id}}</span><br/>
                Email: <span id="email">{{a.email}}</span><br/>
                Name: <span id="name">{{a.firstName}} {{a.lastName}}</span><br/>
                Gender: <span id="gender">{{a.gender}}</span><br/>
                Created Time: <span id="createdTS">{{a.createdTS}}</span><br/>
                Phone Number: <input type="text" name="phone" placeholder="888-888-8888"><br/>
                Address: <input type="text" name="address"><br/>
                Role: <select name="role">
                    <option value="parent">Parent</option>
                    <option value="educator">Educator</option>
                    <option value="admin">Manager</option>
                    </select><br/>
                <button id="update">Update</button>
                <button id="delete">Remove</button>
                <button id="cancel">Cancel</button>
            </div>
        </div>
{% endblock %}