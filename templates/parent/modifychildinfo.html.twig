{% extends "master.html.twig" %}

{% block title %}Children information:{% endblock %}

{% block addHead %}
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script>
        var currId = 0;
        $(document).ajaxError(function() {
            alert("AJAX error");
        });
        $(document).ready(function() {
            $("#showEidtUser").click(function(){
                $("#childrenInfoViewEditPane").show();
            });
            $("#cancel").click(function(){
                $("#childrenInfoViewEditPane").hide();
            });
            $("#childrenInfoUpdate").click(function(){
                var emergencyContactVal = $("input[name=childrenInfoEmergencyContact]").val();
                var emergencyPhoneVal = $("input[name=childrenInfoEmergencyPhone]").val();
                var childObj = {emergencyContact: emergencyContactVal, emergencyPhone: emergencyPhoneVal};
                var josnString = JSON.stringify(childObj);

                $.ajax({
                    url: '/parent/modifychildinfo/' + currId,
                    type: 'PATCH',
                    data: josnString,
                    dataType: 'json'
                }).done(function (newId) {
                    alert("Record with Id=" + currId + "updated");
                    currId = 0;
                    $("#childrenInfoViewEditPane").hide();
                    refreshChildList();

                });
            });

        });
        
        function selectChild(id){
            $.ajax({
                url: '/parent/modifychildinfo/' + id,
                type: 'GET',
                dataType: 'json'
            }).done(function (child) {
                currId = child.id;
                $("#childrenInfoName").html(child.firstName + " " + child.lastName);
                $("#childrenInfoGender").html(child.gender);
                $("#childrenInfoDOB").html(child.dateOfBirth);
                $("input[name=childrenInfoEmergencyContact]").val(child.emergencyContact);
                $("input[name=childrenInfoEmergencyPhone]").val(child.emergencyPhone);
                $("#childrenInfoViewEditPane").show();
            });
        };

        function refreshChildList() {
            location.reload();
            // $.ajax({
            //     url: '/parent/modifychildinfo',
            //     type: 'GET',
            //     dataType: 'json'
            // }).done(function (child) {
            //     var tbody = '<tr><th>ID</th><th>First Name</th><th>Last Name</th><th>Gender</th><th>Date Of Birth</th><th>Emergency Contact</th><th>Emergency Phone</th></tr>';
            //     for (var i = 0; i < childList.length; i++) {
            //         var child = childList[i];
            //         tbody += '<tr onclick="selectUser(' + child.id + ')">';
            //         tbody += '<td>' + child.id + '</td>';
            //         tbody += '<td>' + child.firstName + '</td>';
            //         tbody += '<td>' + child.lastName + '</td>';
            //         tbody += '<td>' + child.gender + '</td>';
            //         tbody += '<td>' + child.dateOfBirth + '</td>';
            //         tbody += '<td>' + child.emergencyContact + '</td>';
            //         tbody += '<td>' + child.emergencyPhone + '</td>';
            //         tbody += '</tr>';
            //     }
            //     $("#childrenInfoMainPane").html(tbody);
            // });
        }

    </script>
 {% endblock %}

{% block content %}

<div id="childrenInfoMainPane">
    <div id="childrenInfoListPane">
        <p><a href="/parent/parent_board">Go back to parent account page</a>. </p>
        <table id="childrenInfoListTable">
            <tr><th>ID</th><th>First Name</th><th>Last Name</th><th>Gender</th><th>Date Of Birth</th><th>Emergency Contact</th><th>Emergency Phone</th></tr>
            {% for a in list %}
            <tr onclick="selectChild('{{a.id}}')">
                <td>{{a.id}}</td>
                <td>{{a.firstName}}</td>
                <td>{{a.lastName}}</td>
                <td>{{a.gender}}</td>
                <td>{{a.dateOfBirth}}</td>
                <td>{{a.emergencyContact}}</td>
                <td>{{a.emergencyPhone}}</td>
            </tr>
            {% endfor %}
        </table>
    </div>

    <div id="childrenInfoViewEditPane" style="display: none;">
        Name: <span id="childrenInfoName">{{a.firstName}} {{a.lastName}}</span><br/>
        Gender: <span id="childrenInfoGender">{{a.gender}}</span><br/>
        Date Of Birth: <span id="childrenInfoDOB">{{a.dateOfBirth}}</span><br/>
        Emergency Contact: <input type="text" name="childrenInfoEmergencyContact"><br/>
        Emergency Phone: <input type="text" name="childrenInfoEmergencyPhone" placeholder="888-888-8888"><br/>
        <button id="childrenInfoUpdate">Update</button>
    </div>

</div>

{% endblock content %}