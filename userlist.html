<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User List</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script>
        var currId = 0;
        $(document).ajaxError(function() {
            alert("AJAX error");
        });
        $(document).ready(function() {
            refreshUserList();
            $("#showEidtUser").click(function(){
                $("#viewEditPane").show();
            });
            $("#cancel").click(function(){
                $("#viewEditPane").hide();
            });
            $("#update").click(function(){
                var phoneVal = $("input[name=phone]").val();
                var addrVal = $("input[name=address]").val();
                var roleVal = $("select[name=role]").val();
                var userObj = {phoneNumber: phoneVal, address: addrVal, role: roleVal};
                var josnString = JSON.stringify(userObj);

                $.ajax({
                    url: '/admin/userlist/' + currId,
                    type: 'PATCH',
                    data: josnString,
                    dataType: 'json'
                }).done(function (newId) {
                    alert("Record with Id=" + currId + "updated");
                    currId = 0;
                    $("#viewEditPane").hide();
                    refreshUserList();

                });
            });

            $("#delete").click(function(){
                if(currId == 0) return;
                if(!confirm("Are you sure you want to delete this user?")) return;
                $.ajax({
                    url: '/admin/userlist/' + currId,
                    type: 'DELETE',
                    dataType: 'json'
                }).done(function (result) {
                    alert("deleted successfully" + result);
                    refreshUserList();
                    currId = 0;
                    $("#viewEditPane").hide();
                });
            });
        });

        function refreshUserList() {
            $.ajax({
                url: '/admin/userlist',
                type: 'GET',
                dataType: 'json'
            }).done(function (userList) {
                var tbody = '<tr><th>#</th><th>Email</th><th>Role</th><th>Account Created Time</th><th>Name</th><th>Gender</th><th>Phone Number</th><th>Address</th></tr>';
                for (var i = 0; i < userList.length; i++) {
                    var user = userList[i];
                    tbody += '<tr onclick="selectUser(' + user.id + ')">';
                    tbody += '<td>' + user.id + '</td>';
                    tbody += '<td>' + user.email + '</td>';
                    tbody += '<td>' + user.role + '</td>';
                    tbody += '<td>' + user.createdTS + '</td>';
                    tbody += '<td>' + user.firstName +" " + user.lastName + '</td>';
                    tbody += '<td>' + user.gender + '</td>';
                    tbody += '<td>' + user.phoneNumber + '</td>';
                    tbody += '<td>' + user.address + '</td>';
                    tbody += '</tr>';
                }
                $("#listTable").html(tbody);
            });
        }

        function selectUser(id){
            $.ajax({
                url: '/admin/userlist/' + id,
                type: 'GET',
                dataType: 'json'
            }).done(function (user) {
                currId = user.id;
                $("#id").html(user.id);
                $("#email").html(user.email);
                $("#name").html(user.firstName + " " + user.lastName);
                $("#gender").html(user.gender);
                $("#createdTS").html(user.createdTS);
                $("input[name=phone]").val(user.phoneNumber);
                $("input[name=address]").val(user.address);
                $("select[name=role]").val(user.role);
                $("#viewEditPane").show();
            });
        }

    </script>
</head>

<body>
    <div id="centerContent">
        <div id="mainAppPane">
            <div id="listPane">
                <table id="listTable"></table>
            </div>
            <div id="viewEditPane" style="display: none;">
                Id: <span id="id"></span><br/>
                Email: <span id="email"></span><br/>
                Name: <span id="name"></span><br/>
                Gender: <span id="gender"></span><br/>
                Created Time: <span id="createdTS"></span><br/>
                Phone Number: <input type="text" name="phone" placeholder="888-888-8888"><br/>
                Address: <input type="text" name="address"><br/>
                Role: <select name="role">
                    <option value="parent">Parent</option>
                    <option value="educator">Educator</option>
                    <option value="admin">Manager</option>
                    </select><br/>
                <button id="update">Update</button>
                <button id="delete">Remove</button>
                <button id="cancel">Cancel</button>
            </div>
        </div>
    </div>
</body>

</html>